<!--
/*
 * tRoll - HTML5 version
 *
 * Copyleft of Sebastiano M. Cossu aka KillerKlown <seb@killerklown.net>
 *
 * tRoll is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * tRoll is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with tRoll.  If not, see <http://www.gnu.org/licenses/>.
 */
-->
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>tRoll</title>
		<style type="text/css">
			body
			{
				text-align:center;
				background-color: #333300;
				color: #FFFFFF;
			}
			label.total
			{
				font: 42pt Helvetica;
				color: #ff9900;
			}

			label.number
			{
				font: 12pt Helvetica;
				color: #FFFFFF;
			}

			label.name
			{
				font: 12pt Helvetica;
				color: #FFFFFF;
			}
			input.main_b
			{
				width: 70px;
				height: 30px;
				color: #FFFFFF;
				background-color: #FF6600;
				border: 2px solid #000;
				font: 12pt Helvetica;
			}
			input.gen_b
			{
				width: 30px;
				height: 30px;
				color: #FFFFFF;
				background-color: #996600;
				border: 2px solid #000;
			}

			td, th
			{
				border: 2px solid #000;
			}
		</style>
		<script type="text/javascript">
			function inc(field)
			{
				var value = parseInt(document.getElementById(field).innerHTML, 10);
				value = isNaN(value) ? 0 : value;
				if(value<20) value++;
				document.getElementById(field).innerHTML = value;
			}	

			function dec(field)
			{
				var value = parseInt(document.getElementById(field).innerHTML, 10);
				value = isNaN(value) ? 0 : value;
				if(value>0) value--;
				document.getElementById(field).innerHTML = value;
			}

			function roll()
			{
				var d4i = parseInt(document.getElementById('dice4').innerHTML, 10);
				var d6i = parseInt(document.getElementById('dice6').innerHTML, 10);
				var d8i = parseInt(document.getElementById('dice8').innerHTML, 10);
				var d10i = parseInt(document.getElementById('dice10').innerHTML, 10);
				var d12i = parseInt(document.getElementById('dice12').innerHTML, 10);
				var d20i = parseInt(document.getElementById('dice20').innerHTML, 10);

				var i=0;
				var x=0;
				var c4=0, c6=0, c8=0, c10=0, c12=0, c20=0;

				var d4t=0; // total d4 val
				var d4s="";
				for(i=0;i<d4i;i++)
				{
					x = Math.floor((Math.random()*4)+1);
					c4 = Math.floor((Math.random()*3)+1);
					if(c4==1) x=Math.floor(x/2)+1;
					else if(c4==2) x=x;
					else if(c4==3) x=Math.floor((Math.random()*4)+1);
					c4 = 0;
					d4t += x;
					d4s += "Lancio #" + i + " per il d4 = " + x + "\n";
				}
				
				var d6t=0;
				var d6s="";
				for(i=0;i<d6i;i++)
				{
					x = Math.floor((Math.random()*6)+1);
					c6 = Math.floor((Math.random()*3)+1);
					if(c6==1) x=Math.floor(x/2)+1;
					else if(c6==2) x=x;
					else if(c6==3) x=Math.floor((Math.random()*6)+1);
					c6 = 0;
					d6t += x;
					d6s += "Lancio #" + i + " per il d6 = " + x + "\n";
				}

				var d8t=0;
				var d8s="";
				for(i=0;i<d8i;i++)
				{
					x = Math.floor((Math.random()*8)+1);
					c8 = Math.floor((Math.random()*3)+1);
					if(c8==1) x=Math.floor(x/2)+1;
					else if(c8==2) x=x;
					else if(c8==3) x=Math.floor((Math.random()*8)+1);
					c8 = 0;
					d8t += x;
					d8s += "Lancio #" + i + " per il d8 = " + x + "\n";
				}
				var d10t=0;
				var d10s="";
				for(i=0;i<d10i;i++)
				{
					x = Math.floor((Math.random()*10)+1);
					c10 = Math.floor((Math.random()*3)+1);
					if(c10==1) x=Math.floor(x/2)+1;
					else if(c10==2) x=x;
					else if(c10==3) x=Math.floor((Math.random()*10)+1);
					c10 = 0;
					d10t += x;
					d10s += "Lancio #" + i + " per il d10 = " + x + "\n";
				}
				
				var d12t=0;
				var d12s="";
				for(i=0;i<d12i;i++)
				{
					x = Math.floor((Math.random()*12)+1);
					c12 = Math.floor((Math.random()*3)+1);
					if(c12==1) x=Math.floor(x/2)+1;
					else if(c12==2) x=x;
					else if(c12==3) x=Math.floor((Math.random()*12)+1);
					c12 = 0;
					d12t += x;
					d12s += "Lancio #" + i + " per il d12 = " + x + "\n";
				}

				var d20t=0;
				var d20s="";
				for(i=0;i<d20i;i++)
				{
					x = Math.floor((Math.random()*20)+1);
					c20 = Math.floor((Math.random()*3)+1);
					if(c20==1) x=Math.floor(x/2)+1;
					else if(c20==2) x=x;
					else if(c20==3) x=Math.floor((Math.random()*20)+1);
					c20 = 0;
					d20t += x;
					d20s += "Lancio #" + i + " per il d20 = " + x + "\n";
				}

				var tot = d4t + d6t + d8t + d10t + d12t + d20t;
				
				var max4 = 4*d4i;
				var max6 = 6*d6i;
				var max8 = 8*d8i;
				var max10 = 10*d10i;
				var max12 = 12*d12i;
				var max20 = 20*d20i;
				var max = max4 + max6 + max8 + max10 + max12 + max20;
				
				var unit = max/4;

				if(tot<=unit)
				{
					document.getElementById('troll').src="img/troll_sbalordito.png";
				}
				else if(tot>unit && tot<=(unit*2))
				{
					document.getElementById('troll').src="img/troll_sospettoso.png";
				}
				else if(tot>(unit*2) && tot<=(unit*3))
				{
					document.getElementById('troll').src="img/troll_laugh.png";
				}
				else if(tot>(unit*3))
				{
					document.getElementById('troll').src="img/troll_happy.png";
				}

				document.getElementById("total").innerHTML = tot;
				document.getElementById("roll_res").value = d4s +  d6s + d8s + d10s + d12s + d20s;
			}

		</script>
	</head>
	<body>
		<form>
			<img id="troll" src="img/troll_serio.png" width="100px" heigth="140px" /><br />
			<label class="total" id="total" value="0">0</label><br />
			<input class="main_b" type="button" name="Roll" onclick="roll();" ontouch="roll();" value="Roll" />
		</form>

		<table style="border:2px solid #000;" align="center">
			<tr>
				<td>
					<form>
						<label class="name">D4:</label>
						<label class="number" id="dice4" value="0">0</label><br />
						<input class="gen_b" type="button" onclick="inc('dice4')" ontouch="inc('dice4');" value="+" />
						<input class="gen_b" type="button" onclick="dec('dice4')" ontouch="dec('dice4');" value="-" />
					</form>
				</td>
				<td>
					<form>
						<label class="name">D6:</label>
						<label class="number" id="dice6" value="0">0</label><br />
						<input class="gen_b" type="button" onclick="inc('dice6')" ontouch="inc('dice6');" value="+" />
						<input class="gen_b" type="button" onclick="dec('dice6')" ontouch="dec('dice6');" value="-" />
					</form>
				</td>
				<td>
					<form>
						<label class="name">D8:</label>
						<label class="number" id="dice8" value="0">0</label><br />
						<input class="gen_b" type="button" onclick="inc('dice8')" ontouch="inc('dice8');" value="+" />
						<input class="gen_b" type="button" onclick="dec('dice8')" ontouch="dec('dice8');" value="-" />
					</form>
				</td>
			</tr>
			<tr>
				<td>
					<form>
						<label class="name">D10:</label>
						<label class="number" id="dice10" value="0">0</label><br />
						<input class="gen_b" type="button" onclick="inc('dice10')" ontouch="inc('dice10');" value="+" />
						<input class="gen_b" type="button" onclick="dec('dice10')" ontouch="dec('dice10');" value="-" />
					</form>
				</td>
				<td>
					<form>
						<label class="name">D12:</label>
						<label class="number" id="dice12" value="0">0</label><br />
						<input class="gen_b" type="button" onclick="inc('dice12')" ontouch="inc('dice12');" value="+" />
						<input class="gen_b" type="button" onclick="dec('dice12')" ontouch="dec('dice12');" value="-" />
					</form>
				</td>
				<td>
					<form>
						<label class="name">D20:</label>
						<label class="number" id="dice20" value="0">0</label><br />
						<input class="gen_b" type="button" onclick="inc('dice20')" ontouch="inc('dice20');" value="+" />
						<input class="gen_b" type="button" onclick="dec('dice20')" ontouch="dec('dice20');" value="-" />
					</form>
				</td>
			</tr>
		</table>
		<br />
		<textarea id="roll_res" readonly="yes" cols="30" rows="6"></textarea>
	</body>
</html>
